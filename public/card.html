<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="./jquery.js"> </script>


<title>ATT连环炮</title>


<style>
    h1
    {
        text-shadow: 2px 5px 2px rgb(255, 136, 15);
    }

    .stochastic{margin:0 auto;}

    div、
    {
        margin: 0,0,0,0;
        padding:0,0,0,0;
    }

     td
    {
        width: 50%;
    }

    body
    {
        /*是否随着屏幕一起移动*/
        background-attachment: fixed;
         /*不允许重复*/
        background-repeat: no-repeat;
    }

</style>



<head>
    <h1 style="text-align:center">ATT连环炮——小赌怡情！</h1>
</head>	
    
    
<body>

    <div style="width:100% ;height:400px ;background-color:rgb(255, 180, 90); ">
        
        <div style="width:50%; height:400px ;background-color:rgb(75, 0, 90); float:left;">
            
            <table style="text-align:center; width:100%; height:70%;" border="1">
                <tr>
                    <td colspan="2" style="text-align:center">ATT连环炮</td>
                </tr>

                <tr>
                    <td>五条</td>
                    <td id="bonus_0">750</td>
                </tr>

                <tr>
                    <td>皇家大顺</td>
                    <td id="bonus_1">250</td>
                </tr>

                <tr>
                    <td>同花顺</td>
                    <td id="bonus_2">120</td>
                </tr>

                <tr>
                    <td>四条</td>
                    <td id="bonus_3">60</td>
                </tr>

            </table>

            <table style="text-align:center; width:100%; height:30%;" border="1">
                <tr>
                    <td>彩币</td>
                    <td id="toral_points">1000</td>
                </tr>

                <tr>
                    <td>押分</td>
                    <td id="bottom_pour">10</td>
                </tr>

            </table>

        </div>
        
        <div style="width:50%; height:400px ;background-color:rgb(0, 180, 90); float:right;">
            
            <table style="text-align:center; width:100%; height:100%;" border="1">
                
                <tr>
                    <td style="text-align:center" colspan="2" >
                            <div>

                                <p style="text-align:center">卡牌类型是：<p id="right_result"></p></p> 
                            
                            </div>

                    </td>
                </tr>
               
                <tr>
                    <td>五条</td>
                    <td id="poker_0">7500</td>
                </tr>
                
                <tr>
                    <td>皇家大顺</td>
                    <td id="poker_1">2500</td>
                </tr>
                
                <tr>
                    <td>同花顺</td>
                    <td id="poker_2">1200</td>
                </tr>
                
                <tr>
                    <td>四条</td>
                    <td id="poker_3">600</td>
                </tr>
                
                <tr>
                    <td>真葫芦</td>
                    <td id="poker_4">100</td>
                </tr>
                
                <tr>
                    <td>同花</td>
                    <td id="poker_5">70</td>
                </tr>
                
                <tr>
                    <td>顺子</td>
                    <td id="poker_6">50</td>
                </tr>
                
                <tr>
                    <td>三条</td>
                    <td id="poker_7">30</td>
                </tr>
                
                <tr>
                    <td>两队</td>
                    <td id="poker_8">20</td>
                </tr>
                
                <tr>   
                    <td>一对</td>
                    <td id="poker_9">10</td>
                </tr>
            
            </table>
        
        </div>

    </div>

    <div style="width: 100% ;height:419px ">

        <div  style="width: 20% ; text-align: center;  float:left ; height:400px; ">
            <image id='card_0'   src="./image/4/2.png"  width="100%"; >
            <label id="card_lable_0">HOLD</label>
        </div>

        <div  style="width: 20% ; text-align: center;  float:left ; height:400px; ">
            <image id='card_1'   src="./image/2/2.png"  width="100%"; >
            <label id="card_lable_1">HOLD</label>
        </div> 
        
        <div  style="width: 20% ; text-align: center;  float:left ; height:400px; ">
            <image id='card_2'   src="./image/3/2.png"  width="100%"; >
            <label id="card_lable_2">HOLD</label>
        </div>
        
        <div  style="width: 20% ; text-align: center;  float:left ; height:400px; ">
            <image id='card_3'   src="./image/0/0.png"  width="100%"; >
            <label id="card_lable_3">HOLD</label>
        </div>  
        
        <div  style="width: 20% ; text-align: center;  float:left ; height:400px; ">
            <image id='card_4'   src="./image/1/2.png"  width="100%"; >
            <label id="card_lable_4">HOLD</label>
        </div>
        
    </div>

  


    <div class="stochastic" style="width: 100% ;height:400px; background-color:yellow; text-align: center">

        <div style="width:25%; height:10%;" text-align="center"> 

            <form action="#" style="float:left;">
                <input id="pour_input" type="text" name="num" style="display:block; text-align:center;"/>
            </form>

            <button id="plus" style="float:left; margin:0px 0px 0px 10px;">+</button>
            
            <button id="minus"  style="float:rightt; margin:0px 0px 0px 10px;">-</button>
        
            <button id="start" onclick="onclickrandom()" style="float:left; margin:0px 0px 0px 10px;">开始</button>
        
            <button  onclick="onclickreset()" style="float:left; margin:0px 0px 0px 10px;">切换彩币</button>
        </div> 
    </div>   

    <script>
        let gameStart = false;
        
        const bonusText=[];
        for(let i=0;i<4;i++)
        {
           bonusText.push($('#bonus_'+i));
        }

        const pokerText=[];
        for(let i=0;i<10;i++)
        {
           pokerText.push($('#poker_'+i));
        }

        const pokerRate=[750,250,120,60,10,7,5,3,2,1]

        //  console.log(randomcards());
        const cardImage = [];

        const cardLabels= [];

        let keep=new Array(5).fill(null);

        for(let i=0;i<=4;i++)
        {
            const card=$(`#card_${i}`);
            cardImage.push(card);
            const text = $(`#card_lable_${i}`)
            cardLabels.push(text);
            text.isShown = false
            text.hide()
            card.on('click',()=>
            {
                if(!gameStart)
                {
                    alert("游戏正在加载!");
                }
                else
                {
                    text.isShown = !text.isShown
                    text.isShown?text.show():text.hide()
                    
                    if(text.isShown)
                    {
                        keep.push(i)
                    }
                    else
                    {
                        delete keep[keep.indexOf(i)]
                    }

                    const temp = []
                    keep.forEach(e=>
                    {
                        if(e||e===0)
                        {
                            temp.push(e)
                        }
                    }
                    )
                    keep = temp.sort()//排序后的数据
                }
            }
            )
        }

        const pourInput=$('#pour_input');

        const plusBth=$('#plus');

        const minusBth=$('#minus');

        const startBth=$('#start');

        let pourScore=0;

        plusBth.on('click',()=>
        {
        if(!gameStart)
        {
            pourScore+=100;
            pourInput.val(pourScore);
            updateDisplay();
        }

        else
        {
            alert("亲，游戏已开始，请停止继续下注");
        }

        }
        )

        minusBth.on('click',()=>{
            if(!gameStart)
            {
                if(pourScore<=0)
                {
                    pourScore=0;
                }
                else
                {
                    pourScore-=100;
                    pourInput.val(pourScore);
                }
                updateDisplay();
            }
            else
            {
                alert("亲，游戏已开始，请停止继续下注");
            }
        }
        )

        let updateDisplay=score =>
        {
            for(let i=0;i<pokerRate.length;i++)
            {
                const td=pokerText[i];
                const rate=pokerRate[i];

                if(pourScore===0)
                {
                    td.text(1*rate);
                }

                else
                {
                    td.text(pourScore*rate);
                }
            }
        }

        function onclickrandom()
        {
            let cards;
            if(!gameStart)
            {
                $.post('/pour',
                {
                    coin:pourScore,
                    start:gameStart
                },
                function (res)
                {
                    let gamest=res.gameStart;
                    console.log('----res2:',res);
                    if(res.code===0)
                    {
                        gameStart=gamest;
                        $(`#toral_points`).text(res.currCoin)
                        $.get('./random',function (res)
                        {
                            cards=res.cards;
                            console.log('----res:',res);
                            for(let i =0;i<cards.length;i++)
                            {
                                const card=cards[i];
                                const url=`./image/${card._type}/${card._value}.png`;
                                $(`#card_${i}`).attr('src',url);
                            }
                            $(`#right_result`).text(res.result);
                        }
                        );
                        $(`#start`).text('换牌');
                    }
                    else
                    {
                        alert(res.desc)
                    }
                }
                );
            }

            else
            {
                $.post('./switch'
                ,{
                    keepcard:keep,
                    pourCoin:pourScore,
                    length:keep.length,
                },

                function(res)
                {
                    const cards=res.cards;

                    for(let i =0;i<cards.length;i++)
                    {
                            const card=cards[i];
                            const url=`./image/${card._type}/${card._value}.png`;
                            $(`#card_${i}`).attr('src',url);
                    }

                    $(`#right_result`).text(res.result); 
                    $(`#toral_points`).text(res.gameCoin);     
                }
                );

                $(`#start`).text('开始');
                gameStart=false;

                for(let i=0;i<5;i++)
                {
                    cardLabels[i].isShown = false;
                    cardLabels[i].hide();
                }
                keep=new Array(5).fill(null);
                onclickreset();
            }
        }

        function onclickreset()
        {
          for(let i=0;i<5;i++)
          {
              $(`#card_${i}`).attr('src',`./image/background.png`);
          }
        }
    </script>
    
</body>
</html>